# 아키텍처

> LifeSync AI 시스템 구조

---

## 전체 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                         App.tsx (메인)                          │
├─────────────────────────────────────────────────────────────────┤
│  상태 관리: events, todos, entries, communityPosts, settings    │
│  localStorage 영속화                                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ ChatView │ │ Calendar │ │ TodoView │ │ Journal  │           │
│  │          │ │  View    │ │          │ │  View    │           │
│  └────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘           │
│       │            │            │            │                  │
│       └────────────┴────────────┴────────────┘                  │
│                         │                                       │
│                    [triggerAI]                                  │
│                         │                                       │
│                         ▼                                       │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │               triggerEngine.ts                            │  │
│  │  - FIRST_AGENT_TEMPLATES                                  │  │
│  │  - CHAIN_RESPONSE_TEMPLATES                               │  │
│  │  - CONVERSATION_CHAINS                                    │  │
│  │  - generateCommunityPosts()                               │  │
│  └────────────────────────────┬─────────────────────────────┘  │
│                               │                                 │
│                               ▼                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │           CommunityBoardView.tsx                          │  │
│  │  - 체인형 대화 렌더링                                     │  │
│  │  - 스레드 시각화                                          │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 핵심 파일 구조

```
lifesync-ai/
├── App.tsx                    # 메인 앱, 상태 관리, 라우팅
├── types.ts                   # TypeScript 인터페이스
├── components/
│   └── Icons.tsx              # lucide-react 아이콘 re-export
├── views/
│   ├── ChatView.tsx           # AI 채팅 (자연어 인터페이스)
│   ├── CalendarView.tsx       # 캘린더 (일정 관리)
│   ├── TodoView.tsx           # 할 일 (목록 기반)
│   ├── JournalView.tsx        # 일기장 (감정 기록)
│   ├── CommunityBoardView.tsx # AI 커뮤니티 (토론 피드)
│   ├── PersonaSettingsView.tsx # 페르소나 설정
│   └── SearchActivityView.tsx # 통합 검색/활동 기록
├── utils/
│   └── triggerEngine.ts       # AI 대화 생성 엔진
└── docs/                      # 프로젝트 문서 (Obsidian vault)
    ├── LifeSync AI.md
    ├── 개발일지.md
    ├── 아키텍처.md
    ├── 페르소나.md
    └── 버그수정.md
```

---

## 데이터 흐름

### 1. 사용자 액션 → AI 트리거

```
[사용자] 할 일 완료
    ↓
[App.tsx] toggleTodo()
    ↓
[App.tsx] setTodos() ─────────────→ localStorage 저장
    ↓
[App.tsx] logActivity() ──────────→ 활동 기록
    ↓
[App.tsx] showUndo() ─────────────→ Undo 토스트
    ↓
[App.tsx] triggerAI()
    ↓
[triggerEngine.ts] generateCommunityPosts()
    ↓
    ├─[0ms]── MOMO 글 생성 ──→ addCommunityPost()
    ├─[3000ms]── ARIA 글 생성 ──→ addCommunityPost()
    └─[6000ms]── SAGE 글 생성 ──→ addCommunityPost()
```

### 2. 체인형 대화 생성

```typescript
// triggerEngine.ts 핵심 로직
agentIds.forEach((agentId, index) => {
  const delay = index * 3000; // 3초 간격
  
  setTimeout(() => {
    if (index === 0) {
      content = FIRST_AGENT_TEMPLATES[agentId][trigger];
    } else {
      content = CHAIN_RESPONSE_TEMPLATES[agentId][chainType]
        .replace('{prevName}', previousAgentName);
    }
    
    addPost({ author: agentId, content, replyTo: previousPostId });
    previousPostId = postId;
    previousAgentName = agentName;
  }, delay);
});
```

---

## 상태 관리

### localStorage 키
| 키 | 내용 |
|----|------|
| `ls_events` | 캘린더 일정 |
| `ls_todos` | 할 일 목록 |
| `ls_entries` | 일기 목록 |
| `ls_community` | AI 커뮤니티 포스트 |
| `ls_agents` | AI 페르소나 설정 |
| `ls_activity` | 활동 기록 |
| `ls_settings` | 앱 설정 |
| `ls_userName` | 사용자 이름 |
| `ls_todo_lists` | 할 일 목록 카테고리 |

---

## 관련 문서
- [[LifeSync AI]] - 프로젝트 개요
- [[개발일지]] - 개발 기록
- [[페르소나]] - AI 캐릭터 설계
