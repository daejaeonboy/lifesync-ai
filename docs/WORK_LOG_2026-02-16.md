# LifeSync AI 작업 로그 (2026-02-16)

## 배포 정보
- Firebase 프로젝트: `life-a01e2`
- Hosting 배포 완료: `https://life-a01e2.web.app`
- 배포 명령: `firebase deploy --only hosting`
- 빌드 검증: `npm run build` 통과

## 이번 반영 내용
### 1) AI 일기/게시글 길이 최적화
- AI 일기 생성 길이 가이드를 장문에서 중간 길이로 조정.
- 토큰 상한을 낮춰 비용과 과도한 출력 길이를 완화.
- 반영 파일:
  - `utils/triggerEngine.ts`
  - `supabase/functions/process-ai-triggers/index.ts`

### 2) 페르소나 그룹 채팅 기능 개선
- 채팅 세션에 다중 페르소나 선택 정보(`agentIds`) 저장.
- 메시지별 작성 페르소나(`agentId`) 표시.
- 페르소나 순차 응답(앞선 답변 문맥 반영)으로 동작하도록 변경.
- 반영 파일:
  - `types.ts`
  - `App.tsx`
  - `views/ChatView.tsx`
  - `services/geminiService.ts`

### 3) 1:1 채팅 안정화
- 새 채팅 시작 시 선택 페르소나를 기본적으로 1명으로 초기화.
- 채팅 툴바에 `단일(1:1) / 다중` 선택 모드 추가.
- 단일 모드에서는 항상 한 명만 선택되도록 제한.
- 반영 파일:
  - `App.tsx`
  - `views/ChatView.tsx`

### 4) 응답 포맷 정리
- 페르소나 응답에 `[이름]`, `이름:` 같은 자기 태그가 붙는 경우 제거하도록 프롬프트/후처리 보강.
- 반영 파일:
  - `services/geminiService.ts`

### 5) Gemini 모델명 연동 수정
- Gemini 3 preview 모델명으로 기본값/옵션/호출 정규화 통일:
  - `gemini-3-flash-preview`
  - `gemini-3-pro-preview`
- 구형 표기(`gemini-3.0-*`, `gemini-3-*`) 자동 변환 로직 추가.
- 반영 파일:
  - `utils/aiConfig.ts`
  - `utils/gemini.ts`
  - `services/geminiService.ts`
  - `views/SettingsView.tsx`
  - `views/ApiSettingsView.tsx`
  - `supabase/functions/process-ai-triggers/index.ts`
  - `App.tsx`

### 6) 채팅 히스토리 선택 시 무한 루프 완화
- 메시지 동기화 시 동일 데이터 재설정 방지 가드 추가.
- `onUpdateMessages` 중복 전송/반영 차단.
- 반영 파일:
  - `views/ChatView.tsx`
  - `App.tsx`

## 비고
- `supabase/functions/process-ai-triggers/index.ts`가 변경되었으므로, 서버 자동화 경로에도 동일 반영이 필요하면 Supabase Edge Function 재배포가 필요함.
